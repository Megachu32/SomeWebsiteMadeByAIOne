<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubik's Clock Game</title>
    <!-- Library untuk screenshot (HTML to Canvas) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --clock-body: #6ab7ff;
            --clock-face: #333;
            --hand-color: #fff;
            --pin-up: #ffd700;
            --pin-down: #5c4033;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        /* --- DISPLAY BOX --- */
        .display-box {
            position: relative;
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .swap-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
            z-index: 10;
        }
        .swap-btn:hover { background-color: #555; }

        /* Struktur Rubik */
        .rubiks-body {
            width: 300px;
            height: 300px;
            background-color: var(--clock-body);
            border-radius: 40px;
            position: relative;
            padding: 15px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2), 0 5px 10px rgba(0,0,0,0.2);
            /* Penting agar elemen anak absolute position (seperti Pin) relatif terhadap ini */
        }

        .clock-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 100%;
            height: 100%;
            justify-items: center;
            align-items: center;
        }

        .clock-face {
            width: 70px;
            height: 70px;
            background-color: var(--clock-face);
            border-radius: 50%;
            position: relative;
            border: 2px solid #ddd;
            box-sizing: border-box; /* Agar border tidak menambah ukuran */
        }

        /* Titik jam 12 */
        .clock-face::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background-color: #888;
            border-radius: 50%;
        }

        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            width: 4px;
            height: 28px;
            background-color: var(--hand-color);
            transform-origin: bottom center;
            border-radius: 2px;
            transition: transform 0.3s ease-in-out;
            z-index: 1;
        }
        .hand::before {
            content: '';
            position: absolute;
            bottom: -3px;
            left: -3px;
            width: 10px;
            height: 10px;
            background-color: var(--hand-color);
            border-radius: 50%;
        }

        /* PINS */
        .pin {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.2);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .pin.top-left { top: 85px; left: 85px; }
        .pin.top-right { top: 85px; right: 85px; }
        .pin.bottom-left { bottom: 85px; left: 85px; }
        .pin.bottom-right { bottom: 85px; right: 85px; }

        /* Hiasan Roda */
        .wheel {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px dashed rgba(255,255,255,0.3);
            border-radius: 50%;
            z-index: 2;
        }
        .wheel.tl { top: -10px; left: -10px; }
        .wheel.tr { top: -10px; right: -10px; }
        .wheel.bl { bottom: -10px; left: -10px; }
        .wheel.br { bottom: -10px; right: -10px; }

        /* --- PANEL --- */
        .panel {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-action {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-action:hover { background-color: #45a049; }
        
        .btn-reset { background-color: #f44336; }
        .btn-reset:hover { background-color: #d32f2f; }

        .btn-download { background-color: #2196F3; }
        .btn-download:hover { background-color: #1976D2; }

        .side-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.8);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            pointer-events: none;
        }

    </style>
</head>
<body>

    <div class="display-box">
        <button class="swap-btn" onclick="swapSide()">ðŸ”„ Flip</button>

        <div class="rubiks-body">
            <!-- Hiasan Sudut -->
            <div class="wheel tl"></div> <div class="wheel tr"></div>
            <div class="wheel bl"></div> <div class="wheel br"></div>

            <!-- Grid Jam -->
            <div class="clock-grid" id="clockGrid"></div>

            <!-- Pins -->
            <div class="pin top-left" id="pin0" onclick="togglePin(0)"></div>
            <div class="pin top-right" id="pin1" onclick="togglePin(1)"></div>
            <div class="pin bottom-left" id="pin2" onclick="togglePin(2)"></div>
            <div class="pin bottom-right" id="pin3" onclick="togglePin(3)"></div>

            <!-- Label -->
            <div class="side-label" id="sideLabel">FRONT</div>
        </div>
    </div>

    <div class="panel">
        <button class="btn-action" onclick="randomiseClock()">Randomise</button>
        <button class="btn-action btn-reset" onclick="resetClock()">Reset (Solve)</button>
        <button class="btn-action btn-download" onclick="downloadImage()">Download Image</button>
    </div>

    <script>
        // --- DATA STATE ---
        let clockState = new Array(18).fill(0); // 0-8 Front, 9-17 Back
        let pinState = [false, false, false, false]; // true=UP, false=DOWN
        let isFrontSide = true;

        document.addEventListener('DOMContentLoaded', () => {
            renderClocks();
            renderPins();
        });

        // --- RENDER UTAMA (DISPLAY) ---
        function renderClocks() {
            const grid = document.getElementById('clockGrid');
            grid.innerHTML = '';
            
            const startIndex = isFrontSide ? 0 : 9;

            for (let i = 0; i < 9; i++) {
                const hourValue = clockState[startIndex + i];
                const degrees = hourValue * 30;

                const clockDiv = document.createElement('div');
                clockDiv.className = 'clock-face';
                
                const handDiv = document.createElement('div');
                handDiv.className = 'hand';
                handDiv.style.transform = `rotate(${degrees}deg)`;

                clockDiv.appendChild(handDiv);
                grid.appendChild(clockDiv);
            }
            document.getElementById('sideLabel').innerText = isFrontSide ? "FRONT" : "BACK";
        }

        function renderPins() {
            const colorUp = 'var(--pin-up)';
            const colorDown = 'var(--pin-down)';

            for (let i = 0; i < 4; i++) {
                const pinEl = document.getElementById(`pin${i}`);
                let isUp = pinState[i];
                // Visualisasi: Jika lihat belakang, status pin terlihat kebalikan
                let visualUp = isFrontSide ? isUp : !isUp;

                pinEl.style.backgroundColor = visualUp ? colorUp : colorDown;
                pinEl.style.transform = visualUp ? 'scale(1.1)' : 'scale(0.9)';
                pinEl.style.boxShadow = visualUp ? '0 4px 8px rgba(0,0,0,0.3)' : 'inset 0 2px 5px rgba(0,0,0,0.5)';
            }
        }

        // --- ACTIONS ---
        function swapSide() {
            isFrontSide = !isFrontSide;
            renderClocks();
            renderPins();
        }

        function togglePin(index) {
            pinState[index] = !pinState[index];
            renderPins();
        }

        function randomiseClock() {
            for (let i = 0; i < 18; i++) clockState[i] = Math.floor(Math.random() * 12);
            for (let i = 0; i < 4; i++) pinState[i] = Math.random() < 0.5;
            renderClocks();
            renderPins();
        }

        function resetClock() {
            clockState.fill(0);
            pinState = [false, false, false, false];
            isFrontSide = true;
            renderClocks();
            renderPins();
        }

        // --- FITUR DOWNLOAD ---
        function downloadImage() {
            // 1. Buat Container Invisible untuk menampung kedua sisi
            const wrapper = document.createElement('div');
            wrapper.style.position = 'absolute';
            wrapper.style.left = '-9999px'; // Sembunyikan dari layar
            wrapper.style.top = '0';
            wrapper.style.display = 'flex';
            wrapper.style.gap = '40px';
            wrapper.style.backgroundColor = 'white'; // Background Putih Sesuai Request
            wrapper.style.padding = '40px';
            wrapper.style.alignItems = 'flex-start';
            
            // 2. Generate DOM untuk Sisi Depan
            const frontContainer = createSideDOM(true);
            // 3. Generate DOM untuk Sisi Belakang
            const backContainer = createSideDOM(false);

            wrapper.appendChild(frontContainer);
            wrapper.appendChild(backContainer);
            document.body.appendChild(wrapper);

            // 4. Proses html2canvas
            html2canvas(wrapper, {
                backgroundColor: "#ffffff",
                scale: 2 // Kualitas lebih tinggi
            }).then(canvas => {
                // Trigger download
                const link = document.createElement('a');
                link.download = 'rubiks_clock_scramble.png';
                link.href = canvas.toDataURL();
                link.click();

                // Bersihkan DOM
                document.body.removeChild(wrapper);
            });
        }

        // Helper untuk membuat struktur HTML jam (tanpa mempengaruhi tampilan utama)
        function createSideDOM(isFront) {
            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.flexDirection = 'column';
            container.style.alignItems = 'center';

            // Clone Body Rubik
            const body = document.createElement('div');
            body.className = 'rubiks-body';
            // Pastikan scale reset jika ada CSS global yang mempengaruhi
            body.style.transform = 'none'; 
            
            // Grid
            const grid = document.createElement('div');
            grid.className = 'clock-grid';

            const startIndex = isFront ? 0 : 9;
            for (let i = 0; i < 9; i++) {
                const hour = clockState[startIndex + i];
                const div = document.createElement('div');
                div.className = 'clock-face';
                const hand = document.createElement('div');
                hand.className = 'hand';
                hand.style.transform = `rotate(${hour * 30}deg)`;
                div.appendChild(hand);
                grid.appendChild(div);
            }
            body.appendChild(grid);

            // Pins (Manual Position clone)
            const pinPositions = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];
            const colorUp = '#ffd700'; // Hardcoded dari var CSS
            const colorDown = '#5c4033';

            for(let i=0; i<4; i++) {
                const p = document.createElement('div');
                p.className = `pin ${pinPositions[i]}`;
                
                // Logika Visual Pin untuk Export
                let isUp = pinState[i];
                let visualUp = isFront ? isUp : !isUp;

                p.style.backgroundColor = visualUp ? colorUp : colorDown;
                p.style.transform = visualUp ? 'scale(1.1)' : 'scale(0.9)';
                p.style.boxShadow = visualUp ? '0 4px 8px rgba(0,0,0,0.3)' : 'inset 0 2px 5px rgba(0,0,0,0.5)';
                body.appendChild(p);
            }

            // Wheels Decoration (Agar mirip aslinya)
            const wheels = ['tl', 'tr', 'bl', 'br'];
            wheels.forEach(pos => {
                const w = document.createElement('div');
                w.className = `wheel ${pos}`;
                body.appendChild(w);
            });

            container.appendChild(body);

            // Label di bawah gambar
            const label = document.createElement('h2');
            label.innerText = isFront ? 'FRONT' : 'BACK';
            label.style.marginTop = '15px';
            label.style.fontFamily = 'sans-serif';
            label.style.color = '#333';
            
            container.appendChild(label);

            return container;
        }

    </script>
</body>
</html>